<!doctype html> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=reset.css rel=stylesheet> <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Noto+Sans+TC&display=swap" rel=stylesheet> <link href=client/main.4137159323.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Building a Realtime Election Tracker - Diplateevo</title><link href=/favicon.svg rel=icon type=image/svg+xml><link href=/favicon.png rel=icon type=image/png><meta content="Building a Realtime Election Tracker" name=title><meta name=keywords><meta name=description><meta content="Building a Realtime Election Tracker" property=og:title><meta content=website property=og:type><meta property=og:url><meta content=/cover-default.jpg property=og:image><meta content=Diplateevo property=og:site_name><meta content=en property=og:locale><meta property=og:description><meta content=summary_large_image name=twitter:card><meta content="Building a Realtime Election Tracker" name=twitter:title><script async data-domain=diplateevo.com defer src=https://plausible.io/js/plausible.js></script><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <link href=/favicon.ico rel=icon type=image/x-icon> <div class=svelte-c1jsg1><div class="svelte-n1g6c wrapper"><div class="svelte-n1g6c fill" style="height:undefinedpx"></div> <div class="svelte-n1g6c header"><a class="svelte-n1g6c logo-link" href=/ ><div class="svelte-n1g6c logo">高</div></a> <div class="svelte-n1g6c nav"><a class="svelte-n1g6c nav-link" href=/ >home</a> <a class="svelte-n1g6c nav-link" href=about>about</a><a class="svelte-n1g6c nav-link" href=works>works</a></div></div></div> <div class=svelte-8to34z><div class="svelte-1oze82s grid-wrap"><div class="svelte-1oze82s grid"><h1 class="svelte-1oze82s title title-offset">Building a Realtime Election Tracker</h1> <p class="svelte-1oze82s summary">On January 11th, 2020, Taiwan went to the polls to elect their next President and Legislature. For us at the News Lens, we formed a small team of designers, engineers, and editors to build this year’s election tracker.</p> <div class="svelte-1oze82s cover-image"><div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-1-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-1-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-1-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-1-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-1-1920w.jpg> <img alt="Feature Image" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-1.jpg></picture> </div></div> <div class="svelte-1oze82s meta">Jan 2020</div> <p class=svelte-wrcfx4 lang=en> On January 11th, 2020, Taiwan went to the polls to elect their next President and Legislature. In Taiwan’s short history as a democracy, this election was only the 7th presidential election that Taiwan has held, conducted after months of unrest in Hong Kong and an increasing trend of populism around the world. For us at <a class=svelte-bu32sq href=https://international.thenewslens.com/ rel="noopener noreferrer" target=_blank>the News Lens</a>, we formed a small team of designers, engineers, and editors to build <a class=svelte-bu32sq href=https://international.thenewslens.com/interactive/126882 rel="noopener noreferrer" target=_blank>this year’s election tracker</a>.</p> <p class=svelte-wrcfx4 lang=zh> 2020年1月11號，台灣舉辦了總統立委大選。從台灣民主化到現在的時間不長，這只是第七次總統大選。這段時期，香港正發生反送中事件，以及世界許多國家有往民粹主義發展的趨勢。我和在<a class=svelte-bu32sq href=https://www.thenewslens.com/ rel="noopener nofollow" target=_blank>關鍵評論網</a>的厲害設計師、編輯和產品長藉著這個機會做了一個<a class=svelte-bu32sq href=https://www.thenewslens.com/interactive/126883 rel="noopener nofollow" target=_blank>特別的專題</a>。</p> <h2 lang=en> Product</h2> <h2 lang=zh> 產品規劃</h2> <p class=svelte-wrcfx4 lang=en> Before we started planning the technical details, we began by thinking about election coverage as a product: What do readers care about? What are their reading habits / usage patterns? Who is our audience?</p> <p class=svelte-wrcfx4 lang=zh> 開始討論技術的細節之前，我想先從產品的角度來談這個選舉報導專題：我們必須思考我們讀者所最關注的東西、閱讀習慣和他們的背景。按照這些需求，我們設計的頁面是左側的表格與右側的地圖互相連動。上方是整體的總統或立委選情。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-2-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-2-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-2-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-2-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-2-1920w.jpg> <img alt="Election Tracker Devices" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-2.jpg title="" width=1920></picture> </div> <p class=svelte-wrcfx4 lang=en> For starters, we expected that 80% of our readers would be accessing our content from a mobile device, and the large majority would be looking for Chinese content, although we would also make a version for our English readers. We knew that we wanted to display the results as close to realtime as we possible could, and knew that we wanted to cover presidential, district legislators, party legislators, and indigenous legislators. We also knew that we wanted to create an experience that gave readers content for before, during, and after the election, and to make content that could be built upon and referenced in the future.</p> <p class=svelte-wrcfx4 lang=zh> 第一個考量是我們預期 80% 的讀者會用手機看我們的開票網站，再者，雖然大部分讀者是中文使用者，但也會有英文的讀者對台灣大選有興趣。我們也知道頁面需要最即時的資訊，包含總統、分區立委、不分區立委和原住民立委。而且我們也知道給讀者的體驗不只是選舉開票的過程，在選舉之前跟之後的資訊都很重要。另外，我們也想做出一些未來還可以持續沿用的元件。這開票網站總共花了差不多兩個月的時間完整。包含的團隊主要是一位工程師和一位設計師。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Screenshot-2020-01-24-14.34.45-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Screenshot-2020-01-24-14.34.45-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Screenshot-2020-01-24-14.34.45-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Screenshot-2020-01-24-14.34.45-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Screenshot-2020-01-24-14.34.45-1920w.jpg> <img alt="" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Screenshot-2020-01-24-14.34.45.jpg title="" width=1948></picture> </div> <p class=svelte-wrcfx4 lang=en> To begin, we launched our election coverage by doing an aggregation of political polls in Taiwan, giving readers a more holistic view of trends of support for each of the presidential candidates. This not only gave us a way to promote our election coverage, but also gave us a way to test our new, Svelte-based system for building interactive articles and work out some of the kinks before election day. In total, building this tracker took us about two months, with a dedicated engineer and designer working nearly full time on this project.</p> <p class=svelte-wrcfx4 lang=zh> 我們首先製作的選舉專題，是台灣民意調查結果的綜合呈現，讓我們的讀者能比較完整地了解每位候選人的支持度與支持度的變化趨勢。這個民調專題不但讓我們多增加一個方式推播相關的選舉報導，也讓我們在選舉之前可以測試數位報導的新系統。（下面有補充我們用的 Svelte 框架）</p> <h2 lang=en> Maps</h2> <h2 lang=zh> 地圖</h2> <p class=svelte-wrcfx4 lang=en> Given that the main interaction users make with the election tracker is through the map, the map had to be responsive to user interaction and data updates. To allow users to explore as much of the data as possible, we decided that our map would at have three different layers to interact with.</p> <p class=svelte-wrcfx4 lang=zh> 因為我們的開票頁面中，與使用者最重要的互動是透過地圖的方式，所以我們的地圖一定要有很好的操作體驗，更新資料的反應要迅速。為了讓讀者能夠探索最大量的資料，我們決定頁面的地圖資訊需要分成三個不同層次。</p> <p class=svelte-wrcfx4 lang=en> The topmost layer is the whole country, including the outer islands that are part of Taiwan’s jurisdiction, followed by 22 counties (縣市). Each of the 22 counties can be further divided into towns (鄉鎮區), and the smallest unit of locality which we did not display is the village (里).</p> <p class=svelte-wrcfx4 lang=zh> 最上層是全台灣的圖層，用 22 個縣市來呈現。各個縣市的下一圖層是鄉鎮區。而我們決定不要分到里的層級，因為我們怕讀者會搞不清，現在他在哪一層。</p> <p class=svelte-wrcfx4 lang=en> All of this map data is obtained from <a class=svelte-bu32sq href=https://data.gov.tw/dataset/7438 rel="noopener noreferrer" target=_blank>Taiwan’s government website</a> in the form of a 114MB shapefile. Obviously, if we were to directly convert the shapefile to topojson (a format for browsers to draw maps, more on this later), we’d still be looking at a file that is ~90MB in size; far too big to have every user download to their device.</p> <p class=svelte-wrcfx4 lang=zh> 地圖圖資的原始檔案是<a class=svelte-bu32sq href=https://data.gov.tw/dataset/7438 rel="noopener nofollow" target=_blank>台灣政府提供的 shapefile</a>。很明顯地，如果我們直接把這個檔案轉到 topojson 給 D3 畫地圖，檔案大小大約 90 MB，這麼大的檔案會下載太久，也會影響網站呈現的效能。</p> <p class=svelte-wrcfx4 lang=en> Moreover, the map needs to be processed for special areas (areas that are part of Taiwan’s jurisdiction but may not be part of an official locality, such as 釣魚台) and relocation of the outer islands so that Kinmen and Lienchiang don’t make the map look too big. At first, I processed a few topojson files using QGIS and the shapefile obtained from the government, but after many failed attempts, (ie incorrect island relocation, missing districts, resulting file too large, too many details removed from the map during compression, etc) I decided to create an API endpoint that would process the map that I want on the fly.</p> <p class=svelte-wrcfx4 lang=zh> 還有一個考量是我們的地圖必須把特殊的地區整理出來，有一些屬於台灣控制但被管制沒有人居住的地方，例如釣魚台。地圖還需要把金門和連江移到離本島近一點，不然台灣地圖中間都會是海。一開始的時候，我手動用 QGIS 產生一些 topojson 的檔案，但因為每次做的都有一點不對（外島移的地方不太對、地區不對、檔案還是太大、壓縮的太過度等等），最後我決定用程式依據設定即時產生 topojson 地圖。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-8-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-8-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-8-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-8-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-8-1920w.jpg> <img alt="Dynamic Map Code" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-8.jpg title="" width=1920></picture> </div> <p class=svelte-wrcfx4 lang=en> In essence, the API endpoint takes a few parameters:</p> <ul lang=en><li class=svelte-1cif0r0 lang="undefined"> Map Version: Due to the fact that these borders will change based on redistricting or otherwise, I wanted to future-proof this API by allowing future maps to be easily versioned by year. <li class=svelte-1cif0r0 lang="undefined"> Locality Depth: Do we want the borders of the county, town, village, or district? <li class=svelte-1cif0r0 lang="undefined"> Specific Locality: Do we want the borders of a specific county, town, village, or district? <li class=svelte-1cif0r0 lang="undefined"> Simplification Level: How simplified do we want the resulting JSON file to be? More simplification and quantization means smaller file sizes but also a loss of detail. <li class=svelte-1cif0r0 lang="undefined"> Condensation of Outer Islands: Do we want a map where Kinmen and Lienchiang are where they are geographically or do we want to see them closer to mainland Taiwan? </ul> <p class=svelte-wrcfx4 lang=zh> 基本上，這個 API 有幾個設定：</p> <ul lang=zh><li class=svelte-1cif0r0 lang="undefined"> 地圖版本：因為台灣地區的邊界是變動的，我的系統必須能按照年度去抓不一樣的地圖。 <li class=svelte-1cif0r0 lang="undefined"> 地區層級：我們的地圖要縣市、鄉鎮、里還是選區的邊界線？ <li class=svelte-1cif0r0 lang="undefined"> 特定的地區：我們只要某一個地區的地圖嗎？ <li class=svelte-1cif0r0 lang="undefined"> 壓縮程度：我們想要把地圖簡化和壓縮到什麼程度？雖然簡化會產出更小的檔案，但地圖細節也會相對變少。 <li class=svelte-1cif0r0 lang="undefined"> 外島移動：我們要不要把金門和連江移到比較靠近本島的地方？ </ul> <p class=svelte-wrcfx4 lang=en> However, because legislative districts are not exactly correlated to any one of the existing locales, we had to separately process all of the locales of each of the legislative districts. Because a whole day of searching could not turn up a shapefile for Taiwan’s legislative districts, we decided to create the map ourselves based on which counties, towns, or villages, belonged to which district.</p> <p class=svelte-wrcfx4 lang=zh> 然而，因為區域立委的選區劃分跟我們上面提的地圖地區不一樣，所以我們需要額外去處理選區的地圖圖層。在政府的網站找了老半天，都沒找到選區的地圖，所以就只好自己依據中選會公布的選區劃分資料來做一個選區的地圖。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-3-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-3-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-3-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-3-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-3-1920w.jpg> <img alt="Custom Map Making" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-3.jpg title="" width=2150></picture> </div> <h3 lang=en> SVG vs Canvas</h3> <h3 lang=zh> 必須考慮 SVG 的缺點， Canvas 的優點</h3> <p class=svelte-wrcfx4 lang=en> After constructing a reliable way to generate our topojson, the next question was figuring out how to display it in our browser. The naive approach is to <a class=svelte-bu32sq href=https://medium.com/@mbostock/command-line-cartography-part-1-897aa8f8ca2c rel="noopener noreferrer" target=_blank>simply render the topojson to a SVG</a>. However, the problem with this is that SVGs use the DOM, which means that changes or user interactions with a complex SVG is slow and resource intensive. Add locale labels and mouse interactions and suddenly your SVG implementation slows to a crawl.</p> <p class=svelte-wrcfx4 lang=zh> 做完我們產生地圖的方式之後，我們下一個問題是怎麼顯示到瀏覽器裡。其實如果很<a class=svelte-bu32sq href=https://medium.com/@mbostock/command-line-cartography-part-1-897aa8f8ca2c rel=noopener target=_blank>單純得把 topojson 直接用 D3 顯示 SVG 是很容易</a>，但用 SVG 對效能不是很好。因為 SVG 用的是瀏覽器的 DOM，這變成每次跟地圖互動或者更新資料時，都要用 DOM 去更新。再加上地區的標籤與滑鼠的互動，網頁就會突然變得很慢。</p> <p class=svelte-wrcfx4 lang=en> The alternative is to use a canvas for display and an invisible SVG for interaction. This allows us to avoid expensive DOM operations of maintaining and manipulating the color of each locale on the map and instead use the canvas API to paint our map, while maintaining a SVG just to keep track of when users interact. In my very unscientific benchmarking on my own machine, I found that SVGs needed to be about twice a simplified compared to canvas in order to achieve similar performance. More about <a class=svelte-bu32sq href=https://observablehq.com/@rdmurphy/combining-html-canvas-svg-flatbush-for-super-efficient-hov rel="noopener noreferrer" target=_blank>this method here</a>.</p> <p class=svelte-wrcfx4 lang=zh> 效能比較好的作法是用 canvas 顯示，但用 SVG 接互動的事件。這個做法可以避免 DOM 因為計算每一個不同地區的顏色和位置而變慢。大略的實驗之後，我發現用這種做法大約可以提昇兩倍的效能。如果想要更深入了解這個做法，<a class=svelte-bu32sq href=https://observablehq.com/@rdmurphy/combining-html-canvas-svg-flatbush-for-super-efficient-hov rel="noopener nofollow" target=_blank>可以參考這個教學</a>。</p> <p class=svelte-wrcfx4 lang=en> The optimizations that I could have done on the map are endless. If we were to further optimize the map, I would recommend using some kind of WebGL implementation, potentially <a class=svelte-bu32sq href=https://docs.mapbox.com/mapbox-gl-js/api/ rel="noopener noreferrer" target=_blank>MapboxGL</a> to make map rendering performance even better, but a canvas approach was good enough for this use case.</p> <p class=svelte-wrcfx4 lang=zh> 如果還有更多的時間，其實還可以繼續地優化我們的地圖，例如使用一種 WebGL 的套件、<a class=svelte-bu32sq href=https://docs.mapbox.com/mapbox-gl-js/api/ rel="noopener nofollow" target=_blank>MapboxGL</a> 等等，但我覺得這個專題用 Canvas 就夠好了。</p> <h2 lang=en> Data Pipeline</h2> <h2 lang=zh> 資料流程</h2> <p class=svelte-wrcfx4 lang=en> The data for our election tracker was obtained from the Central Election Committee, which gives us a 3MB JSON file of all the data anytime it is updated. Because this JSON file is so large and can take up to 5 seconds to download from the Central Election Committee, we decided to only fetch it at a regular cadence and process / store it into a database we can control and scale.</p> <p class=svelte-wrcfx4 lang=zh> 因為我們的資料來源是中選會，每次串入的資料是一個 3MB 的 JSON 檔案。因為檔案尺寸這麼大，有時候會需要到五秒的時間才能完成下載，所以我們決定用 cronjob 一分鐘取一次，然後存在我們自己的資料庫裡（Google Datastore）。這樣我們才比較能應對網站的高流量。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-9-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-9-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-9-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-9-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-9-1920w.jpg> <img alt="Data Pipeline" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-9.jpg title="" width=2650></picture> </div> <p class=svelte-wrcfx4 lang=en> To do this, we used a cron job that would fetch the latest data from the Central Election Committee every minute, and separate out presidential and legislative results before storing it into Google Datastore.</p> <p class=svelte-wrcfx4 lang=zh> 然後為了讓編輯們能加上當選註記，我們開了一個 Google Spreadsheet 讓編輯填寫。這個 Spreadsheet 直接連到我們的系統。這個做法後來有出問題，我會在下面一段解釋。</p> <p class=svelte-wrcfx4 lang=en> Then, in order to indicate when a candidate has won, we connected a Google Spreadsheet that allowed our editors to manually mark when a race had been won. The system would then use that data to display the winner on the frontend. As it turns out, this became a problem on the night of the election, which I expand more on in the “lessons learned” section.</p> <h2 lang=en> Election Rules Edge Cases</h2> <h2 lang=zh> 選舉規則特殊狀況</h2> <p class=svelte-wrcfx4 lang=en> In terms of electoral rules, Taiwan follows a simple majority-wins policy for electing it’s president, which is easy to display on a map. However, legislative races follow a fairly complex system:</p> <ul lang=en><li class=svelte-1cif0r0 lang="undefined"> Taiwan’s legislature has a total of 113 seats. <li class=svelte-1cif0r0 lang="undefined"> 73 district legislators are elected through a majority-wins policy for each of the 73 designated districts of Taiwan. <li class=svelte-1cif0r0 lang="undefined"> 34 party legislators are elected through a party-vote system, in which voters vote on a party, and all parties that obtain over 5% of the overall vote get to assign legislators based on the proportion of votes they receive. The legislators of a party elected through this system must be >50% female, according to the order they are ranked in their party list. <li class=svelte-1cif0r0 lang="undefined"> 6 indigenous legislators are elected by two three-member constituencies, picking the top three legislators for each plains and highlands indigenous constituencies. </ul> <p class=svelte-wrcfx4 lang=zh> 台灣選總統是最高票數的候選人贏，這種規則很容易被顯示在地圖上。但是，選立委的規則很複雜，要用地圖呈現是一個蠻大的挑戰：</p> <ul lang=zh><li class=svelte-1cif0r0 lang="undefined"> 台灣立委總共有 113 席。 <li class=svelte-1cif0r0 lang="undefined"> 73 席是分區立委，總共有 73 選區選出各個選區的最高票數候選人。 <li class=svelte-1cif0r0 lang="undefined"> 34 席是不分區立委，投給各個政黨。政黨票超過總票數 5% 的政黨，會按照比例去分配這 34 席。但是用這個方法選上的候選人，有女性保證名額，必須超過50% 是女性。 <li class=svelte-1cif0r0 lang="undefined"> 6 席的原住民立委中，3 席給山地原住民，3 席給平地原住民。 </ul> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-6-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-6-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-6-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-6-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-6-1920w.jpg> <img alt="" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-6.jpg title="" width=1920></picture> </div> <p class=svelte-wrcfx4 lang=en> This logic poses a few challenges. First of all, the topmost level we can display for district legislators is the district itself, because we can’t calculate the color for a county that has multiple districts with different races.</p> <p class=svelte-wrcfx4 lang=zh> 這些邏輯要怎麼呈現呢？首先，分區立委能夠呈現的最高層不是縣市，因為一個縣市如果有多個選區，你沒辦法在無關的選區選出哪一個政黨領先，所以最高層只能顯示各個選區的地圖。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-5-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-5-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-5-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-5-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-5-1920w.jpg> <img alt="" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-5.jpg title="" width=1920></picture> </div> <p class=svelte-wrcfx4 lang=en> Second, because indigenous legislature races elect the top three candidates for each plains and highlands indigenous groups, simply coloring a district with the party of the first-place candidate does not reflect the true breakdown of the vote. Thus, we decided to take the top three candidates and add up the votes based on their political parties, then take the color of the party with the most votes.</p> <p class=svelte-wrcfx4 lang=zh> 第二，因為原住民立委是山地和平地各選出最高票的三位，我們不能直接用最高票的候選人去呈現一個地區，因為這不見得真正代表一個選區的支持。我們討論到後來決定把前三高票按照政黨加起來，然後再選最高票政黨的顏色去呈現。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-4-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-4-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-4-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-4-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-4-1920w.jpg> <img alt="" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-4.jpg title="" width=1920></picture> </div> <p class=svelte-wrcfx4 lang=en> Third, because of the gender rule for party votes, legislators of a party that get elected through this method do not necessarily correspond with the order that they are placed in the party list. As a result, we have to build an algorithm to determine skip over the next male legislator in the list if there are already too many men.</p> <p class=svelte-wrcfx4 lang=zh> 第三，因為不分區立委有女性保證名額，每個政黨所排得不分區席次順序，不一定是選上席次的順序。因此，我們再特別寫一個邏輯來判斷什麼時候需要跳過男性的立委，以滿足因為那個政黨選上的女性比例。</p> <h2 lang=en> Post-Election Graphics</h2> <h2 lang=zh> 選後圖表</h2> <p class=svelte-wrcfx4 lang=en> Another large element of our election coverage was the graphics that we post to social media such as Facebook and Instagram. Because we wanted to be able to generate social media optimized graphics as fast as possible, we needed a method faster than designers plugging in election results into graphic. To achieve this, we built an internal website that would dynamically generate SVGs with the latest data from the Central Election Committee.</p> <p class=svelte-wrcfx4 lang=zh> 我們選舉專題另外一個很大的部分是要提供在網站、FB 和 IG 要發布的圖表。如果等到選舉之後才請設計師出資訊圖表，他們一定會做得又趕又累。因此，我們寫了一個內部用的網站，可以即時用中選會的資料產生他們事先設計好的圖表。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/Artboard-7-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/Artboard-7-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/Artboard-7-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/Artboard-7-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/Artboard-7-1920w.jpg> <img alt="Dynamic Graphic Generation" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/Artboard-7.jpg title="" width=1920></picture> </div> <p class=svelte-wrcfx4 lang=en> To achieve this, designers would first come up with the design of the graphics in the form of an adobe illustrator document. Then we took those graphics and exported each one into a separate SVG. Because SVG files are a XML-based specification, we can port these into our web application in order to make content within the SVG dynamic.</p> <p class=svelte-wrcfx4 lang=zh> 我們的流程是先把設計師設計的圖表輸出成 SVG。因為 SVG 只是一個 XML 類型的檔案，我們可以很容易用網頁框架動態地產生 SVG。用 SVG 這樣操作的好處是用什麼程式語言或框架都可以。在我們的用途中，是將產出的 SVG 設定為可以下載成 SVG 以及PNG 兩種檔案。</p> <p class=svelte-wrcfx4 lang=en> The great thing about using SVGs in this way is that it is language and tool agnostic, which means you can use whatever existing templating language / framework you use to generate these graphics. In our case, we fitted it into an internal website that the social media team can directly access to download the generated SVG or a PNG format to be posted on social media platforms like Facebook and Instagram.</p> <h2 lang=en> Monitoring</h2> <h2 lang=zh> 系統監控</h2> <p class=svelte-wrcfx4 lang=en> Another critical piece of election-preparedness was making sure that we knew everything that was happening with our web application at all times. To monitor the health of the application and make sure that everything scaled properly, we set up a grafana dashboard that kept track of server errors, response latency, upstream API connections, cache hit ratios, as well as the standard CPU, memory, and database metrics.</p> <p class=svelte-wrcfx4 lang=zh> 另一個很重要的準備是確定我們隨時都能知道系統健不健康，這樣我們才能夠在出事時，有更快的反應。為了系統監控，我們在 Kubernetes Cluster 上運用 Prometheus 和 Grafana 紀錄錯誤、回答速度、往外連線、cache hit 率和比較基本的 CPU、memory 和 DB 等等的資訊。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/DSC04709-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/DSC04709-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/DSC04709-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/DSC04709-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/DSC04709-1920w.jpg> <img alt="Grafana Monitoring" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/DSC04709.jpg title="" width=1919></picture> </div> <p class=svelte-wrcfx4 lang=en> By having the web application directly report metrics to prometheus, it was much easier to get the fine grained metrics specific to elections that we cared about. Because we had taken the time to integrate key metrics into prometheus, when errors began to show up during the election, we were able to immediately know what was causing the error.</p> <p class=svelte-wrcfx4 lang=zh> 把 prometheus 的資訊套在程式上可以比較容易監控一些客製化的資訊。選舉當天 Google spreadsheet 出問題的時候，我們因為有套 prometheus ，所以馬上就知道是 Google 那邊的問題。</p> <h2 lang=en> Svelte</h2> <h2 lang=zh> 紐約時報開發的前端框架</h2> <p class=svelte-wrcfx4 lang=en> Although React has been possibly the most popular front-end framework to use these days, one of the questions I find interesting to ask during interviews is “Under what circumstances is React not a good framework to use? When would you recommend not using React?” This is a question that stumps many less-experienced engineers and people without a good grasp of what React really does in the browser under the hood. In fact, I believe that there are many situations under which React is not a good choice, and building interactives in a news environment is one of them.</p> <p class=svelte-wrcfx4 lang=zh> 最近在前端工程師的世界裡 React 變得很紅，但我最近常常很喜歡問的問題是「怎麼樣的狀況之下你覺得 React 不適合？什麼時候會建議不要用 React 開發一個專案？」這是一個需要比較有經驗的前端工程師才能回答的問題。我認為有很多狀況下 React 不適合。而媒體的特殊數位報導就是其中一個。</p> <div class="svelte-1f31tvi image-wrap undefined"><picture class=svelte-1f31tvi><source media="(max-width: 480px)" srcset=/content/images/2020/08/svelte-480w.jpg><source media="(max-width: 768px)" srcset=/content/images/2020/08/svelte-768w.jpg><source media="(max-width: 1024px)" srcset=/content/images/2020/08/svelte-1024w.jpg><source media="(max-width: 1400px)" srcset=/content/images/2020/08/svelte-1400w.jpg><source media="(max-width: 1920px)" srcset=/content/images/2020/08/svelte-1920w.jpg> <img alt="" class=svelte-1f31tvi loading=lazy src=/content/images/2020/08/svelte.jpg title="" width=712></picture> </div> <p class=svelte-wrcfx4 lang=en> News organizations have a very different development and deployment cycle than tech companies do, requiring tighter deadlines, faster feedback loops, and more bespoke flexibility. Thus, I decided to use <a class=svelte-bu32sq href=https://svelte.dev/ rel="noopener noreferrer" target=_blank>Svelte</a>, giving us the following main advantages among many:</p> <ul lang=en><li class=svelte-1cif0r0 lang="undefined"> Development speed: Given the amount of work to be done within a short amount of time, I decided that Svelte would be much faster to write than React, giving faster development and feedback times. Using Sapper with Svelte would also allow me to write the server-side data APIs quickly and easily. <li class=svelte-1cif0r0 lang="undefined"> Bundled JS Size: Because Svelte runs as a compiler, it’s able to build and include only the code that your applications needs, making the compiled bundle much smaller than a React application. </ul> <p class=svelte-wrcfx4 lang=zh> 新聞對數位報導的開發需求，需要更優雅的程式設計去即時地傳遞與回應訊息，這是一件非常有挑戰性的事情。因此，我這次開發即時開票頁面使用的框架是 <a class=svelte-bu32sq href=https://svelte.dev/ rel="noopener nofollow" target=_blank>Svelte</a>。為什麼要選擇用 Svelte，它有哪裡比 React 好？</p> <ul lang=zh><li class=svelte-1cif0r0 lang="undefined"> 開發速度。Svelte 大致上比 React 要寫的程式碼少 ～30%。這個聽起來可能沒有很多，但 30% 的差別也代表 30% 的效率。 <li class=svelte-1cif0r0 lang="undefined"> 程式大小。因為 Svelte 是一個 Compiler，最終寫完的程式碼檔案很小，因為他只會打包你的程式所需要的東西。 </ul> <p class=svelte-wrcfx4 lang=en> If you’re interested in learning more about Svelte, there are many <a class=svelte-bu32sq href=https://svelte.dev/tutorial/basics rel="noopener noreferrer" target=_blank>tutorials to help you get started</a>.</p> <p class=svelte-wrcfx4 lang=zh> 如果你有興趣學 Svelte，這裏<a class=svelte-bu32sq href=https://svelte.dev/tutorial/basics rel="noopener nofollow" target=_blank>有很多</a>可以參考的教學。</p> <h2 lang=en> Lessons Learned</h2> <h2 lang=zh> 學到的心得</h2> <h3 lang=en> Load Test</h3> <h3 lang=zh> 壓力測試</h3> <p class=svelte-wrcfx4 lang=en> The biggest problem we saw on election night was that the site was down for ~1 hour due to high traffic. Specifically, it wasn’t the servers on our end that could not take the traffic, it was our usage of Google Sheets that caused Google to lock our google spreadsheet when the flow of traffic became too large. After Google locked out requests to the spreadsheet, our system started responding to downstream users with 500 errors, causing the entire site to be inoperable.</p> <p class=svelte-wrcfx4 lang=zh> 我們在選舉當天遇到關鍵評論網的最高流量。這個高流量造成網站有差不多一小時的時間沒辦法使用。而問題是出在我們打 Google Spreadsheets 的流量太高，導致 Google 把我們的 Spreadsheet 封鎖，所以我們的 API 一開始有很大量的錯誤訊息。</p> <p class=svelte-wrcfx4 lang=en> The solution was to first disconnect the spreadsheet from our services, which brought both our service and the google spreadsheet back online. Then, we implemented a quick function that would prevent the service from requesting data from the google spreadsheet so often. This brought everything back online.</p> <p class=svelte-wrcfx4 lang=zh> 排除這個問題的第一步，是把我們系統跟 Google Spreadsheet 的連線斷開，讓 Google Spreadsheet 回復到正常。接下來，我們加了一個很簡單的邏輯，讓我們的程式不要那麼常去打 Google Spreadsheet。這個作法使我們的系統回復到正常狀態。</p> <p class=svelte-wrcfx4 lang=en> The lesson here is that, unless you fully load test your entire system before the election, you never know what problems will be caused when traffic increases by a few orders of magnitude. Often, third-party services such as Google Docs will have their own unwritten throughput and bandwidth limits.</p> <p class=svelte-wrcfx4 lang=zh> 這個事件讓我們學到的是，你永遠不知道高流量可能會造成什麼樣的問題，而你也需要完整地做一個壓力測試，你才能知道第三方服務會有可能出現什麼樣的問題。</p> <h3 lang=en> Have a Clear Incident Response Plan</h3> <h3 lang=zh> 規劃一個明確的反應流程</h3> <p class=svelte-wrcfx4 lang=en> No matter how much planning you do in preparation of the big day, incidents are always likely to happen and things will never go exactly according to plan. That said, after you’ve made all the preparation you can possibly make, the next important thing to plan for is how to respond when things do not go as plan. In our case, by dividing up responsibilities we had a basic level of responsibilities when things went awry, but it would have been more advantageous to rehearse a few scenarios.</p> <p class=svelte-wrcfx4 lang=zh> 不論你做了多少準備，當下發生的事情通常都會跟你預設的不一樣。這代表你做完所有能夠想像的情況準備之後，你還要預設一個當事件發生時的反應流程。這個流程包含跑一些練習，預設誰負責溝通，誰負責修問題。這兩個角色一定需要準備，因為修問題的人需要專心的修問題，沒辦法同時跟大家回報現在的狀況。</p> <p class=svelte-wrcfx4 lang=en> Namely, when the site goes down, it is important to define who will fix the problem and who will report the status to the rest of the team. It is hard for one person to do both, lest the person trying to fix the problem becomes bombarded with too many inquiries about the current status and is unable to concentrate on fixing the problem.</p> <h2 lang=en> Wrapping Up</h2> <h2 lang=zh> 專案結論</h2> <p class=svelte-wrcfx4 lang=en> In conclusion, I hope the process we used and the lessons we learned can be built upon by the community, allowing future elections and similar events to be faster, more efficient, and better experiences for our readers and our organizations. I’m sure that our processes will continue to evolve, and I hope we can continue to learn better workflows and collaboration processes.</p> <p class=svelte-wrcfx4 lang=zh> 我希望我們在關鍵評論遇到的經驗可以幫助大家的思考，讓以後的選舉我們都可以給讀者更好的閱讀體驗。我也希望我們的流程會不斷的進步，讓我們能繼續分享我們學到的東西。</p> <div class="svelte-1oze82s grid-horizontal-rule"></div> </div></div></div></div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){return {slug:"building-a-realtime-election-tracker-for-taiwans-2020-election",id:u,uuid:"4b54e85f-aa5c-4fe1-990d-654910c1e319",title:"Building a Realtime Election Tracker",mobiledoc:"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-2.png\",\"alt\":\"Election Tracker Devices\",\"title\":\"\",\"width\":1920,\"height\":600}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FScreenshot-2020-01-24-14.34.45.png\",\"alt\":\"\",\"title\":\"\",\"width\":1948,\"height\":1040}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-8.png\",\"alt\":\"Dynamic Map Code\",\"title\":\"\",\"width\":1920,\"height\":1080}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-3.png\",\"alt\":\"Custom Map Making\",\"title\":\"\",\"width\":2150,\"height\":600}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-9.png\",\"alt\":\"Data Pipeline\",\"title\":\"\",\"width\":2650,\"height\":1080}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-6.png\",\"alt\":\"\",\"title\":\"\",\"width\":1920,\"height\":1080}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-5.png\",\"alt\":\"\",\"title\":\"\",\"width\":1920,\"height\":1080}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-4.png\",\"alt\":\"\",\"title\":\"\",\"width\":1920,\"height\":1080}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-7.png\",\"alt\":\"Dynamic Graphic Generation\",\"title\":\"\",\"width\":1920,\"height\":1080}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FDSC04709.jpg\",\"alt\":\"Grafana Monitoring\",\"title\":\"\",\"width\":1919,\"height\":938}],[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002Fsvelte.png\",\"alt\":\"\",\"title\":\"\",\"width\":712,\"height\":300}]],\"markups\":[[\"a\",[\"href\",\"https:\u002F\u002Finternational.thenewslens.com\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Finternational.thenewslens.com\u002Finteractive\u002F126882\"]],[\"a\",[\"href\",\"https:\u002F\u002Fwww.thenewslens.com\u002F\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https:\u002F\u002Fwww.thenewslens.com\u002Finteractive\u002F126883\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https:\u002F\u002Fdata.gov.tw\u002Fdataset\u002F7438\"]],[\"a\",[\"href\",\"https:\u002F\u002Fdata.gov.tw\u002Fdataset\u002F7438\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https:\u002F\u002Fmedium.com\u002F@mbostock\u002Fcommand-line-cartography-part-1-897aa8f8ca2c\"]],[\"a\",[\"href\",\"https:\u002F\u002Fmedium.com\u002F@mbostock\u002Fcommand-line-cartography-part-1-897aa8f8ca2c\",\"rel\",\"noopener\"]],[\"a\",[\"href\",\"https:\u002F\u002Fobservablehq.com\u002F@rdmurphy\u002Fcombining-html-canvas-svg-flatbush-for-super-efficient-hov\"]],[\"a\",[\"href\",\"https:\u002F\u002Fobservablehq.com\u002F@rdmurphy\u002Fcombining-html-canvas-svg-flatbush-for-super-efficient-hov\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https:\u002F\u002Fdocs.mapbox.com\u002Fmapbox-gl-js\u002Fapi\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fdocs.mapbox.com\u002Fmapbox-gl-js\u002Fapi\u002F\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https:\u002F\u002Fsvelte.dev\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fsvelte.dev\u002F\",\"rel\",\"noopener nofollow\"]],[\"a\",[\"href\",\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Fbasics\"]],[\"a\",[\"href\",\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Fbasics\",\"rel\",\"noopener nofollow\"]]],\"sections\":[[1,\"p\",[[0,[],0,\"On January 11th, 2020, Taiwan went to the polls to elect their next President and Legislature. In Taiwan’s short history as a democracy, this election was only the 7th presidential election that Taiwan has held, conducted after months of unrest in Hong Kong and an increasing trend of populism around the world. For us at \"],[0,[0],1,\"the News Lens\"],[0,[],0,\", we formed a small team of designers, engineers, and editors to build \"],[0,[1],1,\"this year’s election tracker\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"2020年1月11號，台灣舉辦了總統立委大選。從台灣民主化到現在的時間不長，這只是第七次總統大選。這段時期，香港正發生反送中事件，以及世界許多國家有往民粹主義發展的趨勢。我和在\"],[0,[2],1,\"關鍵評論網\"],[0,[],0,\"的厲害設計師、編輯和產品長藉著這個機會做了一個\"],[0,[3],1,\"特別的專題\"],[0,[],0,\"。\"]]],[1,\"h2\",[[0,[],0,\"Product\"]]],[1,\"h2\",[[0,[],0,\"產品規劃\"]]],[1,\"p\",[[0,[],0,\"Before we started planning the technical details, we began by thinking about election coverage as a product: What do readers care about? What are their reading habits \u002F usage patterns? Who is our audience?\"]]],[1,\"p\",[[0,[],0,\"開始討論技術的細節之前，我想先從產品的角度來談這個選舉報導專題：我們必須思考我們讀者所最關注的東西、閱讀習慣和他們的背景。按照這些需求，我們設計的頁面是左側的表格與右側的地圖互相連動。上方是整體的總統或立委選情。\"]]],[10,0],[1,\"p\",[[0,[],0,\"For starters, we expected that 80% of our readers would be accessing our content from a mobile device, and the large majority would be looking for Chinese content, although we would also make a version for our English readers. We knew that we wanted to display the results as close to realtime as we possible could, and knew that we wanted to cover presidential, district legislators, party legislators, and indigenous legislators. We also knew that we wanted to create an experience that gave readers content for before, during, and after the election, and to make content that could be built upon and referenced in the future.\"]]],[1,\"p\",[[0,[],0,\"第一個考量是我們預期 80% 的讀者會用手機看我們的開票網站，再者，雖然大部分讀者是中文使用者，但也會有英文的讀者對台灣大選有興趣。我們也知道頁面需要最即時的資訊，包含總統、分區立委、不分區立委和原住民立委。而且我們也知道給讀者的體驗不只是選舉開票的過程，在選舉之前跟之後的資訊都很重要。另外，我們也想做出一些未來還可以持續沿用的元件。這開票網站總共花了差不多兩個月的時間完整。包含的團隊主要是一位工程師和一位設計師。\"]]],[10,1],[1,\"p\",[[0,[],0,\"To begin, we launched our election coverage by doing an aggregation of political polls in Taiwan, giving readers a more holistic view of trends of support for each of the presidential candidates. This not only gave us a way to promote our election coverage, but also gave us a way to test our new, Svelte-based system for building interactive articles and work out some of the kinks before election day. In total, building this tracker took us about two months, with a dedicated engineer and designer working nearly full time on this project.\"]]],[1,\"p\",[[0,[],0,\"我們首先製作的選舉專題，是台灣民意調查結果的綜合呈現，讓我們的讀者能比較完整地了解每位候選人的支持度與支持度的變化趨勢。這個民調專題不但讓我們多增加一個方式推播相關的選舉報導，也讓我們在選舉之前可以測試數位報導的新系統。（下面有補充我們用的 Svelte 框架）\"]]],[1,\"h2\",[[0,[],0,\"Maps\"]]],[1,\"h2\",[[0,[],0,\"地圖\"]]],[1,\"p\",[[0,[],0,\"Given that the main interaction users make with the election tracker is through the map, the map had to be responsive to user interaction and data updates. To allow users to explore as much of the data as possible, we decided that our map would at have three different layers to interact with.\"]]],[1,\"p\",[[0,[],0,\"因為我們的開票頁面中，與使用者最重要的互動是透過地圖的方式，所以我們的地圖一定要有很好的操作體驗，更新資料的反應要迅速。為了讓讀者能夠探索最大量的資料，我們決定頁面的地圖資訊需要分成三個不同層次。\"]]],[1,\"p\",[[0,[],0,\"The topmost layer is the whole country, including the outer islands that are part of Taiwan’s jurisdiction, followed by 22 counties (縣市). Each of the 22 counties can be further divided into towns (鄉鎮區), and the smallest unit of locality which we did not display is the village (里).\"]]],[1,\"p\",[[0,[],0,\"最上層是全台灣的圖層，用 22 個縣市來呈現。各個縣市的下一圖層是鄉鎮區。而我們決定不要分到里的層級，因為我們怕讀者會搞不清，現在他在哪一層。\"]]],[1,\"p\",[[0,[],0,\"All of this map data is obtained from \"],[0,[4],1,\"Taiwan’s government website\"],[0,[],0,\" in the form of a 114MB shapefile. Obviously, if we were to directly convert the shapefile to topojson (a format for browsers to draw maps, more on this later), we’d still be looking at a file that is ~90MB in size; far too big to have every user download to their device.\"]]],[1,\"p\",[[0,[],0,\"地圖圖資的原始檔案是\"],[0,[5],1,\"台灣政府提供的 shapefile\"],[0,[],0,\"。很明顯地，如果我們直接把這個檔案轉到 topojson 給 D3 畫地圖，檔案大小大約 90 MB，這麼大的檔案會下載太久，也會影響網站呈現的效能。\"]]],[1,\"p\",[[0,[],0,\"Moreover, the map needs to be processed for special areas (areas that are part of Taiwan’s jurisdiction but may not be part of an official locality, such as 釣魚台) and relocation of the outer islands so that Kinmen and Lienchiang don’t make the map look too big. At first, I processed a few topojson files using QGIS and the shapefile obtained from the government, but after many failed attempts, (ie incorrect island relocation, missing districts, resulting file too large, too many details removed from the map during compression, etc) I decided to create an API endpoint that would process the map that I want on the fly.\"]]],[1,\"p\",[[0,[],0,\"還有一個考量是我們的地圖必須把特殊的地區整理出來，有一些屬於台灣控制但被管制沒有人居住的地方，例如釣魚台。地圖還需要把金門和連江移到離本島近一點，不然台灣地圖中間都會是海。一開始的時候，我手動用 QGIS 產生一些 topojson 的檔案，但因為每次做的都有一點不對（外島移的地方不太對、地區不對、檔案還是太大、壓縮的太過度等等），最後我決定用程式依據設定即時產生 topojson 地圖。\"]]],[10,2],[1,\"p\",[[0,[],0,\"In essence, the API endpoint takes a few parameters:\"]]],[3,\"ul\",[[[0,[],0,\"Map Version: Due to the fact that these borders will change based on redistricting or otherwise, I wanted to future-proof this API by allowing future maps to be easily versioned by year.\"]],[[0,[],0,\"Locality Depth: Do we want the borders of the county, town, village, or district?\"]],[[0,[],0,\"Specific Locality: Do we want the borders of a specific county, town, village, or district?\"]],[[0,[],0,\"Simplification Level: How simplified do we want the resulting JSON file to be? More simplification and quantization means smaller file sizes but also a loss of detail.\"]],[[0,[],0,\"Condensation of Outer Islands: Do we want a map where Kinmen and Lienchiang are where they are geographically or do we want to see them closer to mainland Taiwan?\"]]]],[1,\"p\",[[0,[],0,\"基本上，這個 API 有幾個設定：\"]]],[3,\"ul\",[[[0,[],0,\"地圖版本：因為台灣地區的邊界是變動的，我的系統必須能按照年度去抓不一樣的地圖。\"]],[[0,[],0,\"地區層級：我們的地圖要縣市、鄉鎮、里還是選區的邊界線？\"]],[[0,[],0,\"特定的地區：我們只要某一個地區的地圖嗎？\"]],[[0,[],0,\"壓縮程度：我們想要把地圖簡化和壓縮到什麼程度？雖然簡化會產出更小的檔案，但地圖細節也會相對變少。\"]],[[0,[],0,\"外島移動：我們要不要把金門和連江移到比較靠近本島的地方？\"]]]],[1,\"p\",[[0,[],0,\"However, because legislative districts are not exactly correlated to any one of the existing locales, we had to separately process all of the locales of each of the legislative districts. Because a whole day of searching could not turn up a shapefile for Taiwan’s legislative districts, we decided to create the map ourselves based on which counties, towns, or villages, belonged to which district.\"]]],[1,\"p\",[[0,[],0,\"然而，因為區域立委的選區劃分跟我們上面提的地圖地區不一樣，所以我們需要額外去處理選區的地圖圖層。在政府的網站找了老半天，都沒找到選區的地圖，所以就只好自己依據中選會公布的選區劃分資料來做一個選區的地圖。\"]]],[10,3],[1,\"h3\",[[0,[],0,\"SVG vs Canvas\"]]],[1,\"h3\",[[0,[],0,\"必須考慮 SVG 的缺點， Canvas 的優點\"]]],[1,\"p\",[[0,[],0,\"After constructing a reliable way to generate our topojson, the next question was figuring out how to display it in our browser. The naive approach is to \"],[0,[6],1,\"simply render the topojson to a SVG\"],[0,[],0,\". However, the problem with this is that SVGs use the DOM, which means that changes or user interactions with a complex SVG is slow and resource intensive. Add locale labels and mouse interactions and suddenly your SVG implementation slows to a crawl.\"]]],[1,\"p\",[[0,[],0,\"做完我們產生地圖的方式之後，我們下一個問題是怎麼顯示到瀏覽器裡。其實如果很\"],[0,[7],1,\"單純得把 topojson 直接用 D3 顯示 SVG 是很容易\"],[0,[],0,\"，但用 SVG 對效能不是很好。因為 SVG 用的是瀏覽器的 DOM，這變成每次跟地圖互動或者更新資料時，都要用 DOM 去更新。再加上地區的標籤與滑鼠的互動，網頁就會突然變得很慢。\"]]],[1,\"p\",[[0,[],0,\"The alternative is to use a canvas for display and an invisible SVG for interaction. This allows us to avoid expensive DOM operations of maintaining and manipulating the color of each locale on the map and instead use the canvas API to paint our map, while maintaining a SVG just to keep track of when users interact. In my very unscientific benchmarking on my own machine, I found that SVGs needed to be about twice a simplified compared to canvas in order to achieve similar performance. More about \"],[0,[8],1,\"this method here\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"效能比較好的作法是用 canvas 顯示，但用 SVG 接互動的事件。這個做法可以避免 DOM 因為計算每一個不同地區的顏色和位置而變慢。大略的實驗之後，我發現用這種做法大約可以提昇兩倍的效能。如果想要更深入了解這個做法，\"],[0,[9],1,\"可以參考這個教學\"],[0,[],0,\"。\"]]],[1,\"p\",[[0,[],0,\"The optimizations that I could have done on the map are endless. If we were to further optimize the map, I would recommend using some kind of WebGL implementation, potentially \"],[0,[10],1,\"MapboxGL\"],[0,[],0,\" to make map rendering performance even better, but a canvas approach was good enough for this use case.\"]]],[1,\"p\",[[0,[],0,\"如果還有更多的時間，其實還可以繼續地優化我們的地圖，例如使用一種 WebGL 的套件、\"],[0,[11],1,\"MapboxGL\"],[0,[],0,\" 等等，但我覺得這個專題用 Canvas 就夠好了。\"]]],[1,\"h2\",[[0,[],0,\"Data Pipeline\"]]],[1,\"h2\",[[0,[],0,\"資料流程\"]]],[1,\"p\",[[0,[],0,\"The data for our election tracker was obtained from the Central Election Committee, which gives us a 3MB JSON file of all the data anytime it is updated. Because this JSON file is so large and can take up to 5 seconds to download from the Central Election Committee, we decided to only fetch it at a regular cadence and process \u002F store it into a database we can control and scale.\"]]],[1,\"p\",[[0,[],0,\"因為我們的資料來源是中選會，每次串入的資料是一個 3MB 的 JSON 檔案。因為檔案尺寸這麼大，有時候會需要到五秒的時間才能完成下載，所以我們決定用 cronjob 一分鐘取一次，然後存在我們自己的資料庫裡（Google Datastore）。這樣我們才比較能應對網站的高流量。\"]]],[10,4],[1,\"p\",[[0,[],0,\"To do this, we used a cron job that would fetch the latest data from the Central Election Committee every minute, and separate out presidential and legislative results before storing it into Google Datastore.\"]]],[1,\"p\",[[0,[],0,\"然後為了讓編輯們能加上當選註記，我們開了一個 Google Spreadsheet 讓編輯填寫。這個 Spreadsheet 直接連到我們的系統。這個做法後來有出問題，我會在下面一段解釋。\"]]],[1,\"p\",[[0,[],0,\"Then, in order to indicate when a candidate has won, we connected a Google Spreadsheet that allowed our editors to manually mark when a race had been won. The system would then use that data to display the winner on the frontend. As it turns out, this became a problem on the night of the election, which I expand more on in the “lessons learned” section.\"]]],[1,\"h2\",[[0,[],0,\"Election Rules Edge Cases\"]]],[1,\"h2\",[[0,[],0,\"選舉規則特殊狀況\"]]],[1,\"p\",[[0,[],0,\"In terms of electoral rules, Taiwan follows a simple majority-wins policy for electing it’s president, which is easy to display on a map. However, legislative races follow a fairly complex system:\"]]],[3,\"ul\",[[[0,[],0,\"Taiwan’s legislature has a total of 113 seats.\"]],[[0,[],0,\"73 district legislators are elected through a majority-wins policy for each of the 73 designated districts of Taiwan.\"]],[[0,[],0,\"34 party legislators are elected through a party-vote system, in which voters vote on a party, and all parties that obtain over 5% of the overall vote get to assign legislators based on the proportion of votes they receive. The legislators of a party elected through this system must be \u003E50% female, according to the order they are ranked in their party list.\"]],[[0,[],0,\"6 indigenous legislators are elected by two three-member constituencies, picking the top three legislators for each plains and highlands indigenous constituencies.\"]]]],[1,\"p\",[[0,[],0,\"台灣選總統是最高票數的候選人贏，這種規則很容易被顯示在地圖上。但是，選立委的規則很複雜，要用地圖呈現是一個蠻大的挑戰：\"]]],[3,\"ul\",[[[0,[],0,\"台灣立委總共有 113 席。\"]],[[0,[],0,\"73 席是分區立委，總共有 73 選區選出各個選區的最高票數候選人。\"]],[[0,[],0,\"34 席是不分區立委，投給各個政黨。政黨票超過總票數 5% 的政黨，會按照比例去分配這 34 席。但是用這個方法選上的候選人，有女性保證名額，必須超過50% 是女性。\"]],[[0,[],0,\"6 席的原住民立委中，3 席給山地原住民，3 席給平地原住民。\"]]]],[10,5],[1,\"p\",[[0,[],0,\"This logic poses a few challenges. First of all, the topmost level we can display for district legislators is the district itself, because we can’t calculate the color for a county that has multiple districts with different races.\"]]],[1,\"p\",[[0,[],0,\"這些邏輯要怎麼呈現呢？首先，分區立委能夠呈現的最高層不是縣市，因為一個縣市如果有多個選區，你沒辦法在無關的選區選出哪一個政黨領先，所以最高層只能顯示各個選區的地圖。\"]]],[10,6],[1,\"p\",[[0,[],0,\"Second, because indigenous legislature races elect the top three candidates for each plains and highlands indigenous groups, simply coloring a district with the party of the first-place candidate does not reflect the true breakdown of the vote. Thus, we decided to take the top three candidates and add up the votes based on their political parties, then take the color of the party with the most votes.\"]]],[1,\"p\",[[0,[],0,\"第二，因為原住民立委是山地和平地各選出最高票的三位，我們不能直接用最高票的候選人去呈現一個地區，因為這不見得真正代表一個選區的支持。我們討論到後來決定把前三高票按照政黨加起來，然後再選最高票政黨的顏色去呈現。\"]]],[10,7],[1,\"p\",[[0,[],0,\"Third, because of the gender rule for party votes, legislators of a party that get elected through this method do not necessarily correspond with the order that they are placed in the party list. As a result, we have to build an algorithm to determine skip over the next male legislator in the list if there are already too many men.\"]]],[1,\"p\",[[0,[],0,\"第三，因為不分區立委有女性保證名額，每個政黨所排得不分區席次順序，不一定是選上席次的順序。因此，我們再特別寫一個邏輯來判斷什麼時候需要跳過男性的立委，以滿足因為那個政黨選上的女性比例。\"]]],[1,\"h2\",[[0,[],0,\"Post-Election Graphics\"]]],[1,\"h2\",[[0,[],0,\"選後圖表\"]]],[1,\"p\",[[0,[],0,\"Another large element of our election coverage was the graphics that we post to social media such as Facebook and Instagram. Because we wanted to be able to generate social media optimized graphics as fast as possible, we needed a method faster than designers plugging in election results into graphic. To achieve this, we built an internal website that would dynamically generate SVGs with the latest data from the Central Election Committee.\"]]],[1,\"p\",[[0,[],0,\"我們選舉專題另外一個很大的部分是要提供在網站、FB 和 IG 要發布的圖表。如果等到選舉之後才請設計師出資訊圖表，他們一定會做得又趕又累。因此，我們寫了一個內部用的網站，可以即時用中選會的資料產生他們事先設計好的圖表。\"]]],[10,8],[1,\"p\",[[0,[],0,\"To achieve this, designers would first come up with the design of the graphics in the form of an adobe illustrator document. Then we took those graphics and exported each one into a separate SVG. Because SVG files are a XML-based specification, we can port these into our web application in order to make content within the SVG dynamic.\"]]],[1,\"p\",[[0,[],0,\"我們的流程是先把設計師設計的圖表輸出成 SVG。因為 SVG 只是一個 XML 類型的檔案，我們可以很容易用網頁框架動態地產生 SVG。用 SVG 這樣操作的好處是用什麼程式語言或框架都可以。在我們的用途中，是將產出的 SVG 設定為可以下載成 SVG 以及PNG 兩種檔案。\"]]],[1,\"p\",[[0,[],0,\"The great thing about using SVGs in this way is that it is language and tool agnostic, which means you can use whatever existing templating language \u002F framework you use to generate these graphics. In our case, we fitted it into an internal website that the social media team can directly access to download the generated SVG or a PNG format to be posted on social media platforms like Facebook and Instagram.\"]]],[1,\"h2\",[[0,[],0,\"Monitoring\"]]],[1,\"h2\",[[0,[],0,\"系統監控\"]]],[1,\"p\",[[0,[],0,\"Another critical piece of election-preparedness was making sure that we knew everything that was happening with our web application at all times. To monitor the health of the application and make sure that everything scaled properly, we set up a grafana dashboard that kept track of server errors, response latency, upstream API connections, cache hit ratios, as well as the standard CPU, memory, and database metrics.\"]]],[1,\"p\",[[0,[],0,\"另一個很重要的準備是確定我們隨時都能知道系統健不健康，這樣我們才能夠在出事時，有更快的反應。為了系統監控，我們在 Kubernetes Cluster 上運用 Prometheus 和 Grafana 紀錄錯誤、回答速度、往外連線、cache hit 率和比較基本的 CPU、memory 和 DB 等等的資訊。\"]]],[10,9],[1,\"p\",[[0,[],0,\"By having the web application directly report metrics to prometheus, it was much easier to get the fine grained metrics specific to elections that we cared about. Because we had taken the time to integrate key metrics into prometheus, when errors began to show up during the election, we were able to immediately know what was causing the error.\"]]],[1,\"p\",[[0,[],0,\"把 prometheus 的資訊套在程式上可以比較容易監控一些客製化的資訊。選舉當天 Google spreadsheet 出問題的時候，我們因為有套 prometheus ，所以馬上就知道是 Google 那邊的問題。\"]]],[1,\"h2\",[[0,[],0,\"Svelte\"]]],[1,\"h2\",[[0,[],0,\"紐約時報開發的前端框架\"]]],[1,\"p\",[[0,[],0,\"Although React has been possibly the most popular front-end framework to use these days, one of the questions I find interesting to ask during interviews is “Under what circumstances is React not a good framework to use? When would you recommend not using React?” This is a question that stumps many less-experienced engineers and people without a good grasp of what React really does in the browser under the hood. In fact, I believe that there are many situations under which React is not a good choice, and building interactives in a news environment is one of them.\"]]],[1,\"p\",[[0,[],0,\"最近在前端工程師的世界裡 React 變得很紅，但我最近常常很喜歡問的問題是「怎麼樣的狀況之下你覺得 React 不適合？什麼時候會建議不要用 React 開發一個專案？」這是一個需要比較有經驗的前端工程師才能回答的問題。我認為有很多狀況下 React 不適合。而媒體的特殊數位報導就是其中一個。\"]]],[10,10],[1,\"p\",[[0,[],0,\"News organizations have a very different development and deployment cycle than tech companies do, requiring tighter deadlines, faster feedback loops, and more bespoke flexibility. Thus, I decided to use \"],[0,[12],1,\"Svelte\"],[0,[],0,\", giving us the following main advantages among many:\"]]],[3,\"ul\",[[[0,[],0,\"Development speed: Given the amount of work to be done within a short amount of time, I decided that Svelte would be much faster to write than React, giving faster development and feedback times. Using Sapper with Svelte would also allow me to write the server-side data APIs quickly and easily.\"]],[[0,[],0,\"Bundled JS Size: Because Svelte runs as a compiler, it’s able to build and include only the code that your applications needs, making the compiled bundle much smaller than a React application.\"]]]],[1,\"p\",[[0,[],0,\"新聞對數位報導的開發需求，需要更優雅的程式設計去即時地傳遞與回應訊息，這是一件非常有挑戰性的事情。因此，我這次開發即時開票頁面使用的框架是 \"],[0,[13],1,\"Svelte\"],[0,[],0,\"。為什麼要選擇用 Svelte，它有哪裡比 React 好？\"]]],[3,\"ul\",[[[0,[],0,\"開發速度。Svelte 大致上比 React 要寫的程式碼少 ～30%。這個聽起來可能沒有很多，但 30% 的差別也代表 30% 的效率。\"]],[[0,[],0,\"程式大小。因為 Svelte 是一個 Compiler，最終寫完的程式碼檔案很小，因為他只會打包你的程式所需要的東西。\"]]]],[1,\"p\",[[0,[],0,\"If you’re interested in learning more about Svelte, there are many \"],[0,[14],1,\"tutorials to help you get started\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"如果你有興趣學 Svelte，這裏\"],[0,[15],1,\"有很多\"],[0,[],0,\"可以參考的教學。\"]]],[1,\"h2\",[[0,[],0,\"Lessons Learned\"]]],[1,\"h2\",[[0,[],0,\"學到的心得\"]]],[1,\"h3\",[[0,[],0,\"Load Test\"]]],[1,\"h3\",[[0,[],0,\"壓力測試\"]]],[1,\"p\",[[0,[],0,\"The biggest problem we saw on election night was that the site was down for ~1 hour due to high traffic. Specifically, it wasn’t the servers on our end that could not take the traffic, it was our usage of Google Sheets that caused Google to lock our google spreadsheet when the flow of traffic became too large. After Google locked out requests to the spreadsheet, our system started responding to downstream users with 500 errors, causing the entire site to be inoperable.\"]]],[1,\"p\",[[0,[],0,\"我們在選舉當天遇到關鍵評論網的最高流量。這個高流量造成網站有差不多一小時的時間沒辦法使用。而問題是出在我們打 Google Spreadsheets 的流量太高，導致 Google 把我們的 Spreadsheet 封鎖，所以我們的 API 一開始有很大量的錯誤訊息。\"]]],[1,\"p\",[[0,[],0,\"The solution was to first disconnect the spreadsheet from our services, which brought both our service and the google spreadsheet back online. Then, we implemented a quick function that would prevent the service from requesting data from the google spreadsheet so often. This brought everything back online.\"]]],[1,\"p\",[[0,[],0,\"排除這個問題的第一步，是把我們系統跟 Google Spreadsheet 的連線斷開，讓 Google Spreadsheet 回復到正常。接下來，我們加了一個很簡單的邏輯，讓我們的程式不要那麼常去打 Google Spreadsheet。這個作法使我們的系統回復到正常狀態。\"]]],[1,\"p\",[[0,[],0,\"The lesson here is that, unless you fully load test your entire system before the election, you never know what problems will be caused when traffic increases by a few orders of magnitude. Often, third-party services such as Google Docs will have their own unwritten throughput and bandwidth limits.\"]]],[1,\"p\",[[0,[],0,\"這個事件讓我們學到的是，你永遠不知道高流量可能會造成什麼樣的問題，而你也需要完整地做一個壓力測試，你才能知道第三方服務會有可能出現什麼樣的問題。\"]]],[1,\"h3\",[[0,[],0,\"Have a Clear Incident Response Plan\"]]],[1,\"h3\",[[0,[],0,\"規劃一個明確的反應流程\"]]],[1,\"p\",[[0,[],0,\"No matter how much planning you do in preparation of the big day, incidents are always likely to happen and things will never go exactly according to plan. That said, after you’ve made all the preparation you can possibly make, the next important thing to plan for is how to respond when things do not go as plan. In our case, by dividing up responsibilities we had a basic level of responsibilities when things went awry, but it would have been more advantageous to rehearse a few scenarios.\"]]],[1,\"p\",[[0,[],0,\"不論你做了多少準備，當下發生的事情通常都會跟你預設的不一樣。這代表你做完所有能夠想像的情況準備之後，你還要預設一個當事件發生時的反應流程。這個流程包含跑一些練習，\"],[0,[],0,\"預設誰負責溝通，誰負責修問題。這兩個角色一定需要準備\"],[0,[],0,\"，因為修問題的人需要專心的修問題，沒辦法同時跟大家回報現在的狀況。\"]]],[1,\"p\",[[0,[],0,\"Namely, when the site goes down, it is important to define who will fix the problem and who will report the status to the rest of the team. It is hard for one person to do both, lest the person trying to fix the problem becomes bombarded with too many inquiries about the current status and is unable to concentrate on fixing the problem.\"]]],[1,\"h2\",[[0,[],0,\"Wrapping Up\"]]],[1,\"h2\",[[0,[],0,\"專案結論\"]]],[1,\"p\",[[0,[],0,\"In conclusion, I hope the process we used and the lessons we learned can be built upon by the community, allowing future elections and similar events to be faster, more efficient, and better experiences for our readers and our organizations. I’m sure that our processes will continue to evolve, and I hope we can continue to learn better workflows and collaboration processes.\"]]],[1,\"p\",[[0,[],0,\"我希望我們在關鍵評論遇到的經驗可以幫助大家的思考，讓以後的選舉我們都可以給讀者更好的閱讀體驗。我也希望我們的流程會不斷的進步，讓我們能繼續分享我們學到的東西。\"]]]]}",comment_id:u,feature_image:"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002FArtboard-1.png",featured:p,status:s,visibility:q,send_email_when_published:p,created_at:"2020-08-12T13:48:55.000Z",updated_at:"2020-10-01T15:32:55.000Z",published_at:"2020-01-29T05:18:00.000Z",custom_excerpt:v,codeinjection_head:a,codeinjection_foot:a,custom_template:a,canonical_url:a,tags:[{id:w,name:x,slug:t,description:a,feature_image:a,visibility:q,meta_title:a,meta_description:a,created_at:r,updated_at:r,url:y}],authors:[{id:d,name:e,slug:f,email:g,profile_image:h,cover_image:a,bio:a,website:a,location:a,facebook:a,twitter:a,accessibility:a,status:i,meta_title:a,meta_description:a,tour:j,last_seen:b,created_at:k,updated_at:b,roles:[{id:l,name:m,description:n,created_at:c,updated_at:c}],url:o}],primary_author:{id:d,name:e,slug:f,email:g,profile_image:h,cover_image:a,bio:a,website:a,location:a,facebook:a,twitter:a,accessibility:a,status:i,meta_title:a,meta_description:a,tour:j,last_seen:b,created_at:k,updated_at:b,roles:[{id:l,name:m,description:n,created_at:c,updated_at:c}],url:o},primary_tag:{id:w,name:x,slug:t,description:a,feature_image:a,visibility:q,meta_title:a,meta_description:a,created_at:r,updated_at:r,url:y},url:"http:\u002F\u002Flocalhost:2369\u002Fbuilding-a-realtime-election-tracker-for-taiwans-2020-election\u002F",excerpt:v,email:a,og_image:a,og_title:a,og_description:a,twitter_image:a,twitter_title:a,twitter_description:a,meta_title:a,meta_description:a,email_subject:a,works:void 0,pages:{response:[{id:z,uuid:"53414782-f8de-43e0-8583-83be23295a5d",title:"Graphics Journalist, Engineer, Noodle Connoisseur",slug:"about",mobiledoc:"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"image\",{\"src\":\"http:\u002F\u002Flocalhost:2369\u002Fcontent\u002Fimages\u002F2020\u002F08\u002Fprof.jpg\",\"width\":400,\"height\":400,\"cardWidth\":\"\"}],[\"embed\",{\"url\":\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=If69xHnuCyY\",\"html\":\"\u003Ciframe width=\\\"612\\\" height=\\\"344\\\" src=\\\"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002FIf69xHnuCyY?feature=oembed\\\" frameborder=\\\"0\\\" allow=\\\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\\\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\",\"type\":\"video\",\"metadata\":{\"width\":612,\"author_url\":\"https:\u002F\u002Fwww.youtube.com\u002Fuser\u002FTEDxTalks\",\"version\":\"1.0\",\"thumbnail_height\":360,\"provider_url\":\"https:\u002F\u002Fwww.youtube.com\u002F\",\"thumbnail_url\":\"https:\u002F\u002Fi.ytimg.com\u002Fvi\u002FIf69xHnuCyY\u002Fhqdefault.jpg\",\"provider_name\":\"YouTube\",\"height\":344,\"thumbnail_width\":480,\"title\":\"The Promise of Education Technology | Daniel Kao | TEDxUCSD\",\"author_name\":\"TEDx Talks\"}}],[\"html\",{\"html\":\"\u003Cdiv style=\\\"font-size: 0.8em; margin: 20px 0; font-family: 'Roboto Mono', 'Noto Sans TC', monospace;\\\"\u003E\\n© Daniel Kao \\n| \u003Ca target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" href=\\\"mailto:dkao@diplateevo.com\\\"\u003Eemail\u003C\u002Fa\u003E \\n| \u003Ca target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" href=\\\"https:\u002F\u002Fwww.diplateevo.com\u002Frss\\\"\u003Erss\u003C\u002Fa\u003E \\n| \u003Ca target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" href=\\\"https:\u002F\u002Ftwitter.com\u002FDiplateevo\\\"\u003Etwitter\u003C\u002Fa\u003E \\n| \u003Ca target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" href=\\\"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fdanielkao2\u002F\\\"\u003Elinkedin\u003C\u002Fa\u003E \\n| \u003Ca target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" href=\\\"https:\u002F\u002Fgithub.com\u002Fdkaoster\\\"\u003Egithub\u003C\u002Fa\u003E \\n\u003C\u002Fdiv\u003E\"}]],\"markups\":[[\"a\",[\"href\",\"https:\u002F\u002Fwww.cw.com.tw\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fwww.nytimes.com\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fopen.nytimes.com\u002Fa-faster-and-more-flexible-home-page-that-delivers-the-news-readers-want-1522ff64aa86\"]],[\"a\",[\"href\",\"https:\u002F\u002Fwww.niemanlab.org\u002F2018\u002F06\u002Fall-the-news-thats-fit-for-you-the-new-york-times-your-weekly-edition-is-a-brand-new-newsletter-personalized-for-each-recipient\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fopen.nytimes.com\u002Fhttps-open-nytimes-com-the-new-york-times-as-a-tor-onion-service-e0d0b67b7482\"]],[\"a\",[\"href\",\"https:\u002F\u002Fwww.thenewslens.com\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fwww.ed.gov\u002F\"]],[\"a\",[\"href\",\"https:\u002F\u002Fooyala.com\u002F\"]]],\"sections\":[[10,0],[1,\"p\",[[0,[],0,\"I spend my days visualizing news stories for the web and mobile devices, currently for \"],[0,[0],1,\"Commonwealth Magazine\"],[0,[],0,\". Previously, I worked for \"],[0,[1],1,\"the New York Times\"],[0,[],0,\" by rebuilding the \"],[0,[2],1,\"homepage\"],[0,[],0,\", running machine learning algorithms for \"],[0,[3],1,\"news recommendations\"],[0,[],0,\", and contributing to \"],[0,[4],1,\"digital security projects\"],[0,[],0,\". I have also spent time working for \"],[0,[5],1,\"The News Lens\"],[0,[],0,\", The \"],[0,[6],1,\"US Department of Education\"],[0,[],0,\", and \"],[0,[7],1,\"Ooyala\"],[0,[],0,\".\"]]],[1,\"p\",[[0,[],0,\"我平常的時間是在做新聞的視覺化，現任是\"],[0,[0],1,\"天下雜誌\"],[0,[],0,\"的前端工程師，曾任在\"],[0,[1],1,\"紐約時報\"],[0,[],0,\"重新做\"],[0,[2],1,\"首頁\"],[0,[],0,\"、做\"],[0,[3],1,\"新聞推薦系統\"],[0,[],0,\"的實驗和\"],[0,[4],1,\"數位安全的專案\"],[0,[],0,\"。我也曾經待過\"],[0,[5],1,\"關鍵評論網\"],[0,[],0,\"、\"],[0,[6],1,\"美國教育部\"],[0,[],0,\"和 \"],[0,[7],1,\"Ooyala\"],[0,[],0,\"。\"]]],[1,\"p\",[[0,[],0,\"I'm motivated by the belief that when used properly, digital mediums can help readers better understand the complex problems facing societies today. In addition, I believe that newsrooms are among the most conducive environments to experimentation, development, and creativity.\"]]],[1,\"p\",[[0,[],0,\"帶著資工背景進入媒體業，我的初衷是希望運用數位時代的新興技術呈現各種社會複雜的訴求，讓讀者對於切身相關的議題能夠有更好的了解。對他來說，新聞是一個最適合碰撞實驗和創新火花的環境。\"]]],[1,\"p\",[[0,[],0,\"More broadly, I’m interested in the interplay of technology, politics, journalism, international relations, democracy, and education. My spare time is spent eating noodles, surfing, reading, and traveling.\"]]],[1,\"p\",[[0,[],0,\"此外，我也對科技、政治、國際、民主和教育有興趣。我其他的時間喜歡吃麵、衝浪、讀書和旅遊。\"]]],[10,1],[10,2],[1,\"p\",[]]]}",comment_id:z,feature_image:a,featured:p,status:s,visibility:q,created_at:"2020-08-01T12:12:30.000Z",updated_at:"2020-10-01T16:26:17.000Z",published_at:"2020-08-01T12:12:39.000Z",custom_excerpt:a,codeinjection_head:a,codeinjection_foot:a,custom_template:a,canonical_url:a,tags:[],authors:[{id:d,name:e,slug:f,email:g,profile_image:h,cover_image:a,bio:a,website:a,location:a,facebook:a,twitter:a,accessibility:a,status:i,meta_title:a,meta_description:a,tour:j,last_seen:b,created_at:k,updated_at:b,roles:[{id:l,name:m,description:n,created_at:c,updated_at:c}],url:o}],primary_author:{id:d,name:e,slug:f,email:g,profile_image:h,cover_image:a,bio:a,website:a,location:a,facebook:a,twitter:a,accessibility:a,status:i,meta_title:a,meta_description:a,tour:j,last_seen:b,created_at:k,updated_at:b,roles:[{id:l,name:m,description:n,created_at:c,updated_at:c}],url:o},primary_tag:a,url:"http:\u002F\u002Flocalhost:2369\u002Fabout\u002F",excerpt:"I spend my days visualizing news stories for the web and mobile devices,\ncurrently for Commonwealth Magazine [https:\u002F\u002Fwww.cw.com.tw\u002F]. Previously, I\nworked for the New York Times [https:\u002F\u002Fwww.nytimes.com\u002F] by rebuilding the \nhomepage\n[https:\u002F\u002Fopen.nytimes.com\u002Fa-faster-and-more-flexible-home-page-that-delivers-the-news-readers-want-1522ff64aa86]\n, running machine learning algorithms for news recommendations\n[https:\u002F\u002Fwww.niemanlab.org\u002F2018\u002F06\u002Fall-the-news-thats-fit-for-you-the-new-york-times-your-",og_image:a,og_title:a,og_description:a,twitter_image:a,twitter_title:a,twitter_description:a,meta_title:"About",meta_description:a},{id:A,uuid:"f160a483-8fed-4bb7-826b-86bcd014159c",title:"Things I've Made",slug:t,mobiledoc:"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[],\"markups\":[],\"sections\":[[1,\"p\",[[0,[],0,\"A few selected works and write-ups of projects worth sharing. My portfolio largely consists of javascript-based web projects, but occasionally will incorporate various other cartography, video, or 3D modeling projects.\"]]]]}",comment_id:A,feature_image:a,featured:p,status:s,visibility:q,created_at:"2020-08-02T12:22:36.000Z",updated_at:"2020-10-03T07:49:22.000Z",published_at:"2020-08-02T12:22:43.000Z",custom_excerpt:a,codeinjection_head:a,codeinjection_foot:a,custom_template:a,canonical_url:a,tags:[],authors:[{id:d,name:e,slug:f,email:g,profile_image:h,cover_image:a,bio:a,website:a,location:a,facebook:a,twitter:a,accessibility:a,status:i,meta_title:a,meta_description:a,tour:j,last_seen:b,created_at:k,updated_at:b,roles:[{id:l,name:m,description:n,created_at:c,updated_at:c}],url:o}],primary_author:{id:d,name:e,slug:f,email:g,profile_image:h,cover_image:a,bio:a,website:a,location:a,facebook:a,twitter:a,accessibility:a,status:i,meta_title:a,meta_description:a,tour:j,last_seen:b,created_at:k,updated_at:b,roles:[{id:l,name:m,description:n,created_at:c,updated_at:c}],url:o},primary_tag:a,url:"http:\u002F\u002Flocalhost:2369\u002Fworks\u002F",excerpt:"A few selected works and write-ups of projects worth sharing. My portfolio\nlargely consists of javascript-based web projects, but occasionally will\nincorporate various other cartography, video, or 3D modeling projects.",og_image:a,og_title:a,og_description:a,twitter_image:a,twitter_title:a,twitter_description:a,meta_title:"Portfolio",meta_description:"A few selected works and write-ups of projects worth sharing. "}],meta:{pagination:{page:B,limit:15,pages:B,total:2,next:a,prev:a}}},isPage:p}}(null,"2020-10-03T16:55:35.000Z","2020-06-27T14:19:53.000Z","1","Daniel Kao","daniel","dkao@diplateevo.com","\u002F\u002Fwww.gravatar.com\u002Favatar\u002F93e1328b59023ca4779808c6df2538f8?s=250&d=mm&r=x","active","[\"getting-started\"]","2020-06-27T14:19:54.000Z","5ef75589efaa0112adeb5a19","Owner","Blog Owner","http:\u002F\u002Flocalhost:2369\u002Fauthor\u002Fdaniel\u002F",false,"public","2020-08-12T13:59:51.000Z","published","works","5f33f347f4c9bc65cca4be60","On January 11th, 2020, Taiwan went to the polls to elect their next President and Legislature. For us at the News Lens, we formed a small team of designers, engineers, and editors to build this year’s election tracker.","5f33f5d7f4c9bc65cca4be6c","Works","http:\u002F\u002Flocalhost:2369\u002Ftag\u002Fworks\u002F","5f255c2e404cb555fc28eb2c","5f26b00c833ae084d8720717",1))]};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.c853da14.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main","/client/client.c853da14.js")}document.head.appendChild(s)</script> 